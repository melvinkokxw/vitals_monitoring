<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
    <div class="navbar"><span>Real-Time Chart with Plotly.js</span></div>
    <div class="wrapper">
        <div id="chart"></div>
        <script>
            // function getData() {
            //     return Math.random();
            // }  
            // Plotly.plot('chart',[{
            //     y:[getData()],
            //     type:'line'
            // }]);

            // var cnt = 0;
            // setInterval(function(){
            //     Plotly.extendTraces('chart',{ y:[[getData()]]}, [0]);
            //     cnt++;
            //     if(cnt > 500) {
            //         Plotly.relayout('chart',{
            //             xaxis: {
            //                 range: [cnt-500,cnt]
            //             }
            //         });
            //     }
            // },15);
            fetch("http://127.0.0.1:5000/api")
                .then(response => response.json())
                .then(data => {
                    Plotly.newPlot('chart', [{
                        x: data["timestamp"],
                        y: data["hr"],
                        mode: 'scatter',
                        line: { color: '#80CAF6' }
                    }]);

                    if (++cnt === 100) clearInterval(interval);
                });



            var cnt = 0;

            var interval = setInterval(function () {

                fetch("http://127.0.0.1:5000/api")
                    .then(response => response.json())
                    .then(data => {
                        var data_update = {
                            x: [data["timestamp"]],
                            y: [data["hr"]]
                        };

                        console.log(data_update)

                        Plotly.update('chart', data_update)

                        if (++cnt === 100) clearInterval(interval);
                    });
            }, 1000); 
        </script>
    </div>
</body>

</html>